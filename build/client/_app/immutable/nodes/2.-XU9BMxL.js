import{t as D,h as ua,a as _,r as ca,e as C,s as te,b as le}from"../chunks/BVLX1rLE.js";import{i as fa}from"../chunks/BLm8SxSP.js";import{s as Ze,h as oe,O as pa,P as _a,a as ha,b as ka,j as e,M as Ve,c as ga,r as Pe,d as Ae,g as ue,Q as ba,e as Ye,f as je,p as ma,R as Le,S as ya,n as N,T as Ue,V as De,W as Oe,X as xa,Y as Ea,Z as za,_ as Sa,a0 as wa,a1 as Ta,a2 as Ia,a3 as Za,a4 as Aa,i as Da,J as Na,K as ce,k as Ma,$ as Ba,l as d,o as u,q as o,m as t,t as Y,u as Ca,a5 as qe}from"../chunks/D_P7J2Hz.js";import{i as A}from"../chunks/y0faoB-u.js";import{r as Ne,b as he}from"../chunks/BaPMyU2t.js";import{f as Ha,p as Ra,u as Pa,d as Ua,s as Oa}from"../chunks/HjMo7X6l.js";function qa(b,r,a,m){for(var y=[],k=r.length,f=0;f<k;f++)za(r[f].e,y,!0);var T=k>0&&y.length===0&&a!==null;if(T){var S=a.parentNode;Sa(S),S.append(a),m.clear(),re(b,r[0].prev,r[k-1].next)}wa(y,()=>{for(var I=0;I<k;I++){var l=r[I];T||(m.delete(l.k),re(b,l.prev,l.next)),Ta(l.e,!T)}})}function Fa(b,r,a,m,y,k=null){var f=b,T={flags:r,items:new Map,first:null};{var S=b;f=oe?Ze(pa(S)):S.appendChild(_a())}oe&&ha();var I=null,l=!1,x=Ve(()=>{var n=a();return ya(n)?n:n==null?[]:Le(n)});ka(()=>{var n=e(x),p=n.length;if(l&&p===0)return;l=p===0;let i=!1;if(oe){var g=f.data===ga;g!==(p===0)&&(f=Pe(),Ze(f),Ae(!1),i=!0)}if(oe){for(var H=null,c,h=0;h<p;h++){if(ue.nodeType===8&&ue.data===ba){f=ue,i=!0,Ae(!1);break}var se=n[h],W=m(se,h);c=Qe(ue,T,H,null,se,W,h,y,r,a),T.items.set(W,c),H=c}p>0&&Ze(Pe())}oe||Va(n,T,f,y,r,m,a),k!==null&&(p===0?I?Ye(I):I=je(()=>k(f)):I!==null&&ma(I,()=>{I=null})),i&&Ae(!0),e(x)}),oe&&(f=ue)}function Va(b,r,a,m,y,k,f){var T=b.length,S=r.items,I=r.first,l=I,x,n=null,p=[],i=[],g,H,c,h;for(h=0;h<T;h+=1){if(g=b[h],H=k(g,h),c=S.get(H),c===void 0){var se=l?l.e.nodes_start:a;n=Qe(se,r,n,n===null?r.first:n.next,g,H,h,m,y,f),S.set(H,n),p=[],i=[],l=n.next;continue}if(Ya(c,g,h),(c.e.f&De)!==0&&Ye(c.e),c!==l){if(x!==void 0&&x.has(c)){if(p.length<i.length){var W=i[0],U;n=W.prev;var fe=p[0],de=p[p.length-1];for(U=0;U<p.length;U+=1)Fe(p[U],W,a);for(U=0;U<i.length;U+=1)x.delete(i[U]);re(r,fe.prev,de.next),re(r,n,fe),re(r,de,W),l=W,n=de,h-=1,p=[],i=[]}else x.delete(c),Fe(c,l,a),re(r,c.prev,c.next),re(r,c,n===null?r.first:n.next),re(r,n,c),n=c;continue}for(p=[],i=[];l!==null&&l.k!==H;)(l.e.f&De)===0&&(x??(x=new Set)).add(l),i.push(l),l=l.next;if(l===null)continue;c=l}p.push(c),n=c,l=c.next}if(l!==null||x!==void 0){for(var ne=x===void 0?[]:Le(x);l!==null;)(l.e.f&De)===0&&ne.push(l),l=l.next;var ke=ne.length;if(ke>0){var pe=T===0?a:null;qa(r,ne,pe,S)}}Oe.first=r.first&&r.first.e,Oe.last=n&&n.e}function Ya(b,r,a,m){Ea(b.v,r),b.i=a}function Qe(b,r,a,m,y,k,f,T,S,I){var l=(S&Ia)!==0,x=(S&Za)===0,n=l?x?N(y):Ue(y):y,p=(S&xa)===0?f:Ue(f),i={i:p,v:n,k,a:null,e:null,prev:a,next:m};try{return i.e=je(()=>T(b,n,p,I),oe),i.e.prev=a&&a.e,i.e.next=m&&m.e,a===null?r.first=i:(a.next=i,a.e.next=i.e),m!==null&&(m.prev=i,m.e.prev=i.e),i}finally{}}function Fe(b,r,a){for(var m=b.next?b.next.e.nodes_start:a,y=r?r.e.nodes_start:a,k=b.e.nodes_start;k!==m;){var f=Aa(k);y.before(k),k=f}}function re(b,r,a){r===null?b.first=a:(r.next=a,r.e.next=a&&a.e),a!==null&&(a.prev=r,a.e.prev=r&&r.e)}var ja=D('<div class="loading svelte-12plgk0"><p>Načítání knih...</p></div>'),La=D('<div class="error svelte-12plgk0"><p> </p> <button class="retry-button svelte-12plgk0">Zkusit znovu</button></div>'),Qa=D('<div class="empty svelte-12plgk0"><p>Zatím zde nejsou žádné knihy.</p> <a href="/add" class="add-button svelte-12plgk0">Přidat první knihu</a></div>'),Xa=D('<button class="clear-search-button svelte-12plgk0" title="Zobrazit všechny knihy">Zrušit</button>'),Ja=D('<div class="search-error svelte-12plgk0"><p> </p></div>'),Ka=D('<p class="search-results svelte-12plgk0"><!></p>'),Wa=D('<p class="author svelte-12plgk0"> </p>'),Ga=D('<p class="note-content svelte-12plgk0"> </p>'),$a=D('<p class="note-empty svelte-12plgk0">Žádná poznámka</p>'),et=D('<div class="book-card svelte-12plgk0"><h3 class="svelte-12plgk0"> </h3> <!> <div class="note svelte-12plgk0"><!></div> <div class="book-actions svelte-12plgk0"><button class="edit-button svelte-12plgk0">Upravit</button> <button class="delete-button svelte-12plgk0">Smazat</button></div></div>'),at=D('<div class="bottom-add-link svelte-12plgk0"><a href="/add" class="add-button svelte-12plgk0">Přidat novou knihu</a></div>'),tt=D('<div class="books-list svelte-12plgk0"></div> <!>',1),lt=D('<div class="no-results svelte-12plgk0"><p>Žádné knihy neodpovídají vašemu vyhledávání.</p> <button class="clear-search-link svelte-12plgk0">Zobrazit všechny knihy</button></div>'),rt=D('<div class="search-section svelte-12plgk0"><div class="search-container svelte-12plgk0"><input type="text" placeholder="Hledat v knihách (název, autor, poznámka)..." class="search-input svelte-12plgk0"> <div class="search-buttons svelte-12plgk0"><button class="search-button svelte-12plgk0"><!></button> <!></div></div> <!> <!></div> <a href="/add" class="add-button svelte-12plgk0">Přidat novou knihu</a> <!>',1),st=D('<div class="error-message svelte-12plgk0"> </div>'),nt=D('<div class="modal-backdrop svelte-12plgk0" role="button" tabindex="0" aria-label="Zavřít úpravu knihy"></div> <div class="modal svelte-12plgk0"><h3 class="svelte-12plgk0">Upravit knihu</h3> <!> <form><div class="form-group svelte-12plgk0"><label for="edit-title" class="svelte-12plgk0">Název knihy *</label> <input type="text" id="edit-title" placeholder="Zadejte název knihy" required class="svelte-12plgk0"></div> <div class="form-group svelte-12plgk0"><label for="edit-author" class="svelte-12plgk0">Autor</label> <input type="text" id="edit-author" placeholder="Zadejte jméno autora (nepovinné)" class="svelte-12plgk0"></div> <div class="form-group svelte-12plgk0"><label for="edit-note" class="svelte-12plgk0">Poznámka</label> <textarea id="edit-note" placeholder="Zadejte poznámku nebo komentář ke knize (nepovinné)" rows="5" class="svelte-12plgk0"></textarea></div> <div class="modal-actions svelte-12plgk0"><button type="submit" class="save-button svelte-12plgk0"><!></button> <button type="button" class="cancel-button svelte-12plgk0">Zrušit</button></div></form></div>',1),it=D(`<div class="modal-backdrop svelte-12plgk0" role="button" tabindex="0" aria-label="Zrušit mazání knihy"></div> <div class="modal delete-confirm-modal svelte-12plgk0"><h3 class="svelte-12plgk0">Smazat knihu</h3> <p>Opravdu chcete smazat knihu <strong> </strong>?
      Tato akce nelze vrátit.</p> <div class="modal-actions svelte-12plgk0"><button class="delete-confirm-button svelte-12plgk0"><!></button> <button class="cancel-button svelte-12plgk0">Zrušit</button></div></div>`,1),vt=D('<div class="books-container svelte-12plgk0"><h2 class="svelte-12plgk0">Seznam knih</h2> <!></div> <!> <!>',1);function _t(b,r){Da(r,!1);let a=N([]),m=N(!0),y=N(null),k=null,f=N(""),T=N(""),S=N(""),I=N(!1),l=N(!1),x=N(null),n=N(null),p=N(!1),i=N(""),g=N([]),H=N(!1),c=N(null),h=N(!1);async function se(){try{t(m,!0),t(y,null),t(a,await Ha("/api/books"))}catch(s){t(y,s.message),t(a,[])}finally{t(m,!1)}}function W(s){k=s,t(f,s.title||""),t(T,s.author||""),t(S,s.note||""),t(I,!0),t(x,null)}function U(){t(I,!1),k=null}async function fe(){if(!e(f).trim()){t(x,"Název knihy je povinný.");return}try{t(l,!0),t(x,null),await Pa(k.id,{title:e(f),author:e(T)??void 0,note:e(S)??void 0});const s=e(a).findIndex(E=>E.id===k.id);if(s!==-1&&(qe(a,e(a)[s]={...e(a)[s],title:e(f),author:e(T)||e(a)[s].author,note:e(S)}),t(a,[...e(a)]),e(h))){const E=e(g).findIndex(F=>F.id===k.id);E!==-1&&(qe(g,e(g)[E]={...e(a)[s]}),t(g,[...e(g)]))}U()}catch(s){t(x,s.message)}finally{t(l,!1)}}function de(s){t(n,s)}function ne(){t(n,null)}async function ke(s){try{t(p,!0),await Ua(s),t(a,e(a).filter(E=>E.id!==s)),e(h)&&t(g,e(g).filter(E=>E.id!==s)),t(n,null)}catch(E){t(y,E.message)}finally{t(p,!1)}}async function pe(){if(!e(i).trim()){ge();return}try{t(H,!0),t(c,null),t(g,await Oa(e(i).trim())),t(h,!0)}catch(s){t(c,s.message),t(g,[])}finally{t(H,!1)}}function ge(){t(i,""),t(g,[]),t(h,!1),t(c,null)}function be(){return e(h)?e(g):e(a)}Na(()=>{se()}),fa();var Me=vt();ua(s=>{Ba.title="Čtenářský deník | Seznam knih"});var me=ce(Me),Xe=d(u(me),2);{var Je=s=>{var E=ja();_(s,E)},Ke=(s,E)=>{{var F=O=>{var j=La(),V=u(j),L=u(V);o(V);var Z=d(V,2);o(j),Y(()=>te(L,`Došlo k chybě: ${e(y)??""}`)),C("click",Z,se),_(O,j)},ie=(O,j)=>{{var V=Z=>{var Q=Qa();_(Z,Q)},L=Z=>{var Q=rt(),G=ce(Q),$=u(G),q=u($);Ne(q);var R=d(q,2),P=u(R),ye=u(P);{var xe=v=>{var w=le("Hledání...");_(v,w)},Ee=v=>{var w=le("Hledat");_(v,w)};A(ye,v=>{e(H)?v(xe):v(Ee,!1)})}o(P);var _e=d(P,2);{var z=v=>{var w=Xa();C("click",w,ge),_(v,w)};A(_e,v=>{e(h)&&v(z)})}o(R),o($);var X=d($,2);{var ze=v=>{var w=Ja(),J=u(w),ee=u(J);o(J),o(w),Y(()=>te(ee,`Chyba při vyhledávání: ${e(c)??""}`)),_(v,w)};A(X,v=>{e(c)&&v(ze)})}var ea=d(X,2);{var aa=v=>{var w=Ka(),J=u(w);{var ee=M=>{var B=le();Y(()=>te(B,`Žádné knihy neodpovídají vašemu vyhledávání "${e(i)??""}"`)),_(M,B)},ve=M=>{var B=le();Y(()=>te(B,`Nalezeno ${e(g).length??""}
            ${e(g).length===1?"kniha":e(g).length<5?"knihy":"knih"} pro "${e(i)??""}"`)),_(M,B)};A(J,M=>{e(g).length===0?M(ee):M(ve,!1)})}o(w),_(v,w)};A(ea,v=>{e(h)&&v(aa)})}o(G);var ta=d(G,4);{var la=v=>{var w=tt(),J=ce(w);Fa(J,5,be,M=>M.id,(M,B)=>{var Se=et(),we=u(Se),sa=u(we,!0);o(we);var Ce=d(we,2);{var na=K=>{var ae=Wa(),Ie=u(ae);o(ae),Y(()=>te(Ie,`Autor: ${e(B).author??""}`)),_(K,ae)};A(Ce,K=>{e(B).author&&K(na)})}var Te=d(Ce,2),ia=u(Te);{var va=K=>{var ae=Ga(),Ie=u(ae,!0);o(ae),Y(()=>te(Ie,e(B).note)),_(K,ae)},oa=K=>{var ae=$a();_(K,ae)};A(ia,K=>{e(B).note?K(va):K(oa,!1)})}o(Te);var He=d(Te,2),Re=u(He),da=d(Re,2);o(He),o(Se),Y(()=>te(sa,e(B).title)),C("click",Re,()=>W(e(B))),C("click",da,()=>de(e(B))),_(M,Se)}),o(J);var ee=d(J,2);{var ve=M=>{var B=at();_(M,B)};A(ee,M=>{be().length>5&&M(ve)})}_(v,w)},ra=(v,w)=>{{var J=ee=>{var ve=lt(),M=d(u(ve),2);o(ve),C("click",M,ge),_(ee,ve)};A(v,ee=>{e(h)&&ee(J)},w)}};A(ta,v=>{be().length>0?v(la):v(ra,!1)})}Y(v=>{q.disabled=e(H),P.disabled=v},[()=>e(H)||!e(i).trim()],Ve),he(q,()=>e(i),v=>t(i,v)),C("keydown",q,v=>v.key==="Enter"&&pe()),C("click",P,pe),_(Z,Q)};A(O,Z=>{e(a).length===0?Z(V):Z(L,!1)},j)}};A(s,O=>{e(y)?O(F):O(ie,!1)},E)}};A(Xe,s=>{e(m)?s(Je):s(Ke,!1)})}o(me);var Be=d(me,2);{var We=s=>{var E=nt(),F=ce(E),ie=d(F,2),O=d(u(ie),2);{var j=z=>{var X=st(),ze=u(X,!0);o(X),Y(()=>te(ze,e(x))),_(z,X)};A(O,z=>{e(x)&&z(j)})}var V=d(O,2),L=u(V),Z=d(u(L),2);Ne(Z),o(L);var Q=d(L,2),G=d(u(Q),2);Ne(G),o(Q);var $=d(Q,2),q=d(u($),2);ca(q),o($);var R=d($,2),P=u(R),ye=u(P);{var xe=z=>{var X=le("Ukládám...");_(z,X)},Ee=z=>{var X=le("Uložit");_(z,X)};A(ye,z=>{e(l)?z(xe):z(Ee,!1)})}o(P);var _e=d(P,2);o(R),o(V),o(ie),Y(()=>{Z.disabled=e(l),G.disabled=e(l),q.disabled=e(l),P.disabled=e(l),_e.disabled=e(l)}),C("click",F,U),C("keydown",F,z=>z.key==="Escape"&&U()),he(Z,()=>e(f),z=>t(f,z)),he(G,()=>e(T),z=>t(T,z)),he(q,()=>e(S),z=>t(S,z)),C("click",_e,U),C("submit",V,Ra(fe)),_(s,E)};A(Be,s=>{e(I)&&s(We)})}var Ge=d(Be,2);{var $e=s=>{var E=it(),F=ce(E),ie=d(F,2),O=d(u(ie),2),j=d(u(O)),V=u(j);o(j),Ca(),o(O);var L=d(O,2),Z=u(L),Q=u(Z);{var G=R=>{var P=le("Mazání...");_(R,P)},$=R=>{var P=le("Smazat");_(R,P)};A(Q,R=>{e(p)?R(G):R($,!1)})}o(Z);var q=d(Z,2);o(L),o(ie),Y(()=>{te(V,`"${e(n).title??""}"`),Z.disabled=e(p),q.disabled=e(p)}),C("click",F,ne),C("keydown",F,R=>R.key==="Escape"&&ne()),C("click",Z,()=>ke(e(n).id)),C("click",q,ne),_(s,E)};A(Ge,s=>{e(n)&&s($e)})}_(b,Me),Ma()}export{_t as component};
